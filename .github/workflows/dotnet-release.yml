name: dotnet publish

on:
  release: 
    types: published

env:
  DOTNET_VERSION: "9.x.x"
  DOTNET_TFM: "net9.0"

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - os: "win"
            arch: "x64"
            build-name: "PaperMore-win-x64.exe"
          - os: "win"
            arch: "x86"
            build-name: "PaperMore-win-x86.exe"
          - os: "linux"
            arch: "x64"
            build-name: "PaperMore-linux-x64"
          - os: "linux"
            arch: "arm"
            build-name: "PaperMore-linux-arm"
          - os: "linux"
            arch: "arm64"
            build-name: "PaperMore-linux-arm64"
    steps:
      - uses: actions/checkout@v5
      - name: Setup dotnet
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: ${{ env.DOTNET_VERSION }}
      - name: Install dependencies
        run: dotnet restore
      - name: dotnet publish
        env:
          DOTNET_CLI_TELEMETRY_OPTOUT: 1
          DOTNET_SKIP_FIRST_TIME_EXPERIENCE: true
          DOTNET_NOLOGO: true
        run: dotnet publish  -o ./publish --arch ${{ matrix.arch }} --os ${{ matrix.os }} --configuration Release --self-contained --framework ${{ env.DOTNET_TFM }} -p:PublishSingleFile=true -p:IncludeNativeLibrariesForSelfExtract=true -p:EnableCompressionInSingleFile=true -p:DebugSymbols=false ./PaperMore/PaperMore.csproj
      - name: Upload Release Binary
        uses: AButler/upload-release-assets@v3.0
        with:
          files: ./publish/*
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          release-id: ${{ github.event.release.id }}

